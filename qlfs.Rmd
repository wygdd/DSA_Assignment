---
title: "Maths and Statistics Foundations Project"
author: "Team N: Darren Tan (01436826), Joachim Kibsgaard-Petersen (01275660), Linn Bieske (01453725), Qi Zhang (01408680), Sarah Laouiti (01429506), Wenyu Guo (01380750)"
output:
  rmarkdown::html_document:
    theme: lumen
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#1. Introduction

A person’s salary is of interest in various situations: Landlords need income proofs for security and banks evaluate the eligibility of a credit card for a customer. This is all dependent on the person’s regular income. Satisfying the conditions for obtaining a loan is likely to be based off a person’s salary level. A person with a higher level of income would likely be equipped with more credit cards with which they can use to purchase items from retail companies. These retail companies can then tailor different advertisements or discounts on products with prices that are adjusted to the salary of each consumer to achieve better company returns (Mattila and Choi, 2017).

During many situations within a commercial context, however, no information about a person’s salary is provided or can be checked independently. Thus, a model predicting a customer’s salary would be crucial for businesses in order to estimate the customer’s wealth - in terms of their income level, allowing a business to make individual and personalised decisions for each customer. The aim of the project is therefore to create a model that can fulfill this objective. 

In order to do so, we need to determine significant variables that influence salary. After consulting several literature sources, a set of significant variables was determined - including sex, industry sector, educational qualification and age. A descriptive exploration of the chosen parameters in the data set would serve as a guidance for identifying differences in salary.

The built predictive model can provide potential application in different industries and could allow for transferability across different countries with a socioeconomic structure that is similar to the United Kingdom. Another benefit of this model would be the possibility of predicting a person’s salary living in a country for which data is less available for a model to be substantially developed.  

#2. Theory 
Differences in salary is commonplace in today’s reality. Reasons behind why there might be a difference in salary are linked to the existence of an income gap in society (Blinder, 1973). Abovementioned are variables such as sex, age, ethnicity, industrial sector and educational qualifications that are believed to have an impact on salary.

A widely discussed form of this discrepancy in income is gender. The European Commission defines gender pay gap as “the difference between men’s and women’s pay, based on the average difference in gross hourly earnings of all employees” (European Commission, 2017). In recent years especially, addressing the gender-related pay gap has been a policy matter of many countries namely those belonging to the European Union (European Union, 2014). According to Kickbusch and Riedmüller (1984) and Gerhard et al. (1988), the occurrence of this form of difference in salary is apparent as a result of gender discrimination in contemporary society, which has arisen primarily from established hierarchy within a family. 

It is worth investigating whether this apparent income gap is a result of actual gender discrimination or whether this phenomenon arises as a result of other variables’ influences. In that aspect, this investigation will determine other possible causes of the income gap and whether working in different industry sectors or having different educational qualifications can affect salary when included in a linear regression model with salary as the independent variable. 

A person’s age can be related to salary through other implications. It is most logical that in general, a person who is older would have more work experience than a young teenager and would therefore have a larger salary. This can also be said of educational qualification where an older person would generally have attained a higher level of education compared to someone who is younger. It is also true that an industry where a person works in would affect the salary of the person (Bovill, 2015). Logically, someone who is employed in a job where less qualification is necessary would earn less than another individual employed in a professional field. In terms of marriage, there is some sort of implication by Landau and Arthur (1992) that married people seem to earn more than people who have never been married.

According to Brynin and Güveli (2012), ethnic pay gaps are resultant from either the the majority of the ethnic minority group going into more less well-paid careers or that they are merely generally paid less for doing the same kind of work. Fryer (2014) bases the reason why there is a difference between the incomes of people with different ethnic backgrounds on academic grounds, providing further motivation as to why including educational qualification as a variable in the linear regression model is a viable choice. 

Consequently, in order to achieve the report aim, data from the Office of National Statistics Quarterly Labour Force Survey (QLFS) for the period of January to March 2017 will be utilised. Following the investigation of the variables and after modelling linear regressions, inferences will be made that can hopefully aid in the creation of policies associated with salary.

Therefore, the null hypothesis is that all the predictors will not have a significant effect on salary. The alternative hypothesis is that the predictors do have a significant effect on salary.

#3. Methods

The research into the dataset involves the use of various statistical tools in R. The “ggplot” and “knitr” libraries have been imported to help visualise the data. The “dplyr” library has been used to ease the process of data manipulation and the library “lmtest” is implemented to further statistical research.

```{r load data and packages, echo=FALSE, message=FALSE}
library(dplyr)
library(haven)
library(ggplot2)
library(lmtest)
library(knitr)
library(stargazer)
library(gridExtra)
library(texreg)
alldata <- read_dta("lfsp_jm17_eul.dta")
```


## 3.1 Data Description
```{r clean dataset, echo = FALSE}
#Created smaller manageable dataset from larger one which included variables we pre-selceted to explore + filtered data to remove observations where individuals did not answer or ...


selected <- alldata %>% select(AGE,SEX,INDE07M,HIQUL15D,MPNR02,SC10MMJ,BANDG,
                               MARSTA,RELIG11,ETHGBEUL,REGWKR)

colnames(selected) <- c("Age","Sex","Industry","Education",
                        "NumEmployee","Occupation","Salary",
                        "Marital","Religion","Ethnicity","workRegion")
#Salary
selected <- selected %>% filter(Salary!=1 & Salary!=2 & Salary!=3 
                                & Salary!=-8 & Salary!=-9)
#Age
#Sex
#Industry
selected <- selected %>% filter(Industry!=-8)
#Education
selected <- selected %>% filter(Education!=-8 & Education !=-9 & Education !=7)
#NumEmployee
selected <- selected %>% filter(NumEmployee!=-8 & NumEmployee !=-9)
#Occupation
selected <- selected %>% filter(Occupation!=-8 & Occupation!=-9)
#Marital
selected <- selected %>% filter(Marital!=-9)
#Religion
selected <- selected %>% filter(Religion!=-8)
#Ethnicity 
selected <- selected %>% filter(Ethnicity!=-8 & Ethnicity!=-9)
#workRegion
selected <- selected %>% filter(workRegion!=-8 & workRegion!=-9 & workRegion!=2)

# Create dataset qlfs to combine groups, the processed dataset qlfs contains numeric data 
qlfs <- as.data.frame(selected)

#Converted salary from interval to continuous data in order to perform linear regression
# weekly salaries are multiplied by 52 and monthly salaries are multiplied by 12. The salary data is thus in a range of amounts of earnings. In order to implement a linear regression model, we therefore calculated the mean of each range.

#BANDG
value_vec <- c('1.1','1.10','1.11','1.12','1.13','1.14','1.15','1.16','1.17',
               '1.18','1.19','1.2','1.20','1.21','1.22','1.23','1.24','1.25',
               '1.26','1.27','1.28','1.29','1.3','1.30','1.31','1.32','1.33',
               '1.34','1.4','1.5','1.6','1.7','1.8','1.9',
               '2.1','2.10','2.11','2.12','2.13','2.14','2.15','2.16','2.17',
               '2.18','2.19','2.2','2.20','2.21','2.22','2.23','2.24','2.25',
               '2.26','2.27','2.28','2.29','2.3','2.30','2.31','2.32','2.33',
               '2.34','2.4','2.5','2.6','2.7','2.8','2.9',
               "3.10","3.11","3.12","3.13","3.14","3.15","3.16","3.17","3.18",
               "3.19","3.20","3.21","3.22","3.23","3.24","3.25","3.26","3.27",
               "3.28","3.29","3.30","3.31","3.32","3.3","3.4","3.5","3.6",
               "3.7","3.8","3.9","3.2","3.34")
#-- Annually
a1  <- 0 
a2  <- seq(4249.5,4749.5,500)
a3  <- seq(5499.5,12499.5,1000)
a4  <- 249.5
a5  <- seq(13499.5,19499.5,1000)
a6  <-seq(21499.5,27499.5,3000)
a7  <- 749.5
a8  <- seq(30499.5,39499.5,3000)
a9  <- 41000
a10 <- seq(1249.5,3749.5,500)
annual <- c(a1,a2,a3,a4,a5,a6,a7,a8,a9,a10) 

#-- Monthly 
m1  <- 0 
m2  <- seq(424.5, 674.5, 50)
m3  <- seq(749.5, 1049.5, 100)
m4  <- 24.5
m5  <- seq(1149.5, 1949.5, 100)
m6  <- 2099.5
m7  <- 74.5
m8  <- 2349.5
m9  <- seq(2749.5, 3749.5, 500)
m10 <- 4000
m11 <- seq(124.5, 374.5, 50)
month_values <- c(m1, m2, m3, m4, m5, m6, m7, m8, m9, m10, m11)
months_annual <- month_values*12

#-- Weekly
w1 <- seq(84.5,104.5,10)
w2 <- 117
w3 <- seq(137,487,25)
w4 <- seq(524.5,674.5,50)
w5 <- seq(14.5,74.5,10) # for 3.3 to 3.9
w6 <- 5 # for 3.2
w7 <- 750 # for 3.34 weekly 750 or more
week_values <- c(w1,w2,w3,w4,w5,w6,w7)
week_annual <- week_values * 52

#-- Combine annually, monthly and weekly
salay_all <-c(annual,months_annual,week_annual)
salary_dict <- data.frame(key=value_vec,value=salay_all)
salary_dict$key <- as.character(salary_dict$key)

#-- Assign mean salary to qlfs$salary according to salary_dict
for (i in 1:nrow(qlfs)){
  qlfs$Salary[i] <- salary_dict$value[salary_dict$key==qlfs$Salary[i]]
}
#--BANDG of type 'character', change it to numeric
qlfs$Salary <- as.numeric(qlfs$Salary)

#Age
#Continuous numbers, no need for combination

#Sex
#Two groups, male and female, no need for combination

#Industry
qlfs$Industry <- ifelse( qlfs$Industry  == 1 
                        |qlfs$Industry == 2 
                        |qlfs$Industry == 3 
                        |qlfs$Industry == 4 
                        |qlfs$Industry == 6 
                        |qlfs$Industry == 9, 4, qlfs$Industry)
qlfs$Industry <- ifelse( qlfs$Industry  == 5, 1, qlfs$Industry)
qlfs$Industry <- ifelse( qlfs$Industry  == 7, 2, qlfs$Industry)
qlfs$Industry <- ifelse( qlfs$Industry  == 8, 3, qlfs$Industry)


#Education
# NumEmployee
qlfs$NumEmployee <- ifelse(qlfs$NumEmployee  == 1
                      |qlfs$NumEmployee == 2
                      |qlfs$NumEmployee == 3
                      |qlfs$NumEmployee == 4
                      |qlfs$NumEmployee == 5, 1, qlfs$NumEmployee)
qlfs$NumEmployee <- ifelse(qlfs$NumEmployee  == 6
                      |qlfs$NumEmployee == 7
                      |qlfs$NumEmployee == 8, 2, qlfs$NumEmployee)
qlfs$NumEmployee <- ifelse(qlfs$NumEmployee  == 9, 3, qlfs$NumEmployee)


#Occupation
# Marital
qlfs$Marital <- ifelse(!qlfs$Marital ==1 & 
                      !qlfs$Marital ==2, 3 , qlfs$Marital)
#Religion
qlfs$Religion <- ifelse(qlfs$Religion == 1, 1 ,2)

#Ethnicity
qlfs$Ethnicity <- ifelse(  qlfs$Ethnicity == 1 
                          |qlfs$Ethnicity== 2 
                          |qlfs$Ethnicity== 3, 1, qlfs$Ethnicity)
qlfs$Ethnicity <- ifelse(  qlfs$Ethnicity == 5 
                         |qlfs$Ethnicity == 6
                         |qlfs$Ethnicity == 7
                         |qlfs$Ethnicity == 8
                         |qlfs$Ethnicity == 9,  2, qlfs$Ethnicity)
qlfs$Ethnicity <- ifelse( qlfs$Ethnicity  == 10, 3, qlfs$Ethnicity)
qlfs$Ethnicity <- ifelse( qlfs$Ethnicity  == 4
                         |qlfs$Ethnicity == 11, 4, qlfs$Ethnicity)

#workRegion
qlfs$workRegion <- ifelse(qlfs$workRegion  == 20
                      |qlfs$workRegion == 21, 1, qlfs$workRegion)

qlfs$workRegion <- ifelse(qlfs$workRegion  == 1,  2, qlfs$workRegion)
qlfs$workRegion <- ifelse(qlfs$workRegion  == 16
                      |qlfs$workRegion == 17
                      |qlfs$workRegion == 18, 3, qlfs$workRegion)

qlfs$workRegion <- ifelse(qlfs$workRegion  == 3
                      |qlfs$workRegion == 4
                      |qlfs$workRegion == 5,  4, qlfs$workRegion)
qlfs$workRegion <- ifelse(qlfs$workRegion  == 6,  5, qlfs$workRegion)
qlfs$workRegion <- ifelse(qlfs$workRegion  == 14
                      |qlfs$workRegion == 15, 6, qlfs$workRegion)
qlfs$workRegion <- ifelse(qlfs$workRegion  == 19, 8, qlfs$workRegion)
qlfs$workRegion <- ifelse(qlfs$workRegion  == 8
                      |qlfs$workRegion == 9
                      |qlfs$workRegion == 11 , 9, qlfs$workRegion)
qlfs$workRegion <- ifelse(qlfs$workRegion  == 13, 10, qlfs$workRegion)
qlfs$workRegion <- ifelse(qlfs$workRegion  == 12, 11, qlfs$workRegion)
qlfs$workRegion <- ifelse(qlfs$workRegion  == 23, 12, qlfs$workRegion)
qlfs$workRegion <- ifelse(qlfs$workRegion  == 22, 13, qlfs$workRegion)

# Create dataset facQlfs, which change all the categorical variable of qlfs to factor with labels, in order for further linear regression.
facQlfs <- as.data.frame(qlfs)

#Age
#Sex
facQlfs$Sex <- factor( facQlfs$Sex,
                        levels=c(1,2),
                        labels = c('Male','Female'))
#Industry
facQlfs$Industry <- factor( facQlfs$Industry,
                            levels = c(1,2,3,4),
                            labels = c('Distribution, hotels, restaurants',
                                       'Banking, Finance',
                                       'Public admin, education, health',
                                       'Other'))
#Education
facQlfs$Education <- factor( facQlfs$Education, 
                             levels = c(1:6), 
                             labels = c('Degree',
                                        'Higher Education',
                                        'A Level',
                                        'GCSE A*-C',
                                        'Other',
                                        'No'))
#NumEmployee
facQlfs$NumEmployee <- factor(facQlfs$NumEmployee,
                         levels=c(1,2,3),
                         c('Under 50',
                           'Under 500',
                           'Over 500'))
#Occupation
facQlfs$Occupation <- factor(facQlfs$Occupation,
                          levels=c(1:9),
                          c('Managers, Directors, Senior Officials',
                            'Professional',
                            'Associate Professional, Technical',
                            'Administrative, Secretarial',
                            'Skilled Trades',
                            'Caring, Leisure, Other Service',
                            'Sales, Customer Service',
                            'Process, Plant, Machine Operatives',
                            'Elementary'))
# MARSTA
facQlfs$Marital <- factor( facQlfs$Marital, 
                           levels=c(1,2,3),
                           labels = c('Single','Married','Other'))
#RELIG11
facQlfs$Religion <- factor(facQlfs$Religion, 
                           levels=c(1,2),
                           labels = c('No','Yes'))
#ETHGBEUL
facQlfs$Ethnicity <-factor( facQlfs$Ethnicity, 
                            levels = c(1,2,3,4),
                            c('White','Asian','Black','Other')) 
#REGWKR
facQlfs$workRegion <- factor(facQlfs$workRegion,
                         levels = c(1:13),
                         c('Scotland',
                           'North East',
                           'North West',
                           'Yorkshire and the Humber',
                           'East Midlands',
                           'West Midlands',
                           'East of England',
                           'Wales',
                           'London',
                           'South West',
                           'South East',
                           'Outside UK',
                           'Northern Ireland'))

```

The dataset initially consisted of 88,528 observations of 739 variables. This covers 88,528 independent individuals from the UK. The QLFS aims to “inform social, economic and employment policy” (ONS, 2017). As such, the questionnaire covers questions on individual demographics, household characteristics and job information.

In order to further examine the underlying problem of an income gap as well as the relationship between salary and gender and explore the possibility of gender discrimination in the UK, certain variables have been selected such that the final dataset contains 543 observations of 11 variables. These are outlined below.

|Variable                |Description                           |Further information        |
|:-----------------------|:-------------------------------------|---------------------------|
|`Salary`                |Salary of respondent (249.5 - 48000.0)|N.b. adjusted for inflation|
|`Age`                   |Age of respondent (0-99)              |                           |
|`Sex`                   |Gender of respondent                  |**Male**    |
|`Occupation`            |Major occupation group of respondent  |**Managers, Directors and Senior Officials**|
|`Industry`              |Industry sector in main job           |**Distribution, hotels, restaurants**|
|`Education`             |Highest qualification level           |**Degree**|
|`NumEmployee`           |Number of employees at workplace      |**Under 50**|
|`Religion`              |Religion GB level                     |**No**|
|`MaritalStatus`         |Marital status                        |**Single**|
|`Ethnicity`             |Ethnicity of respondent in GB         |**White**|
|`Region of workplace`   |Region of place of work               |**North East**|

**base category**

For ease of analysis, the smaller dataset is manipulated. Salary was converted from intervals to continuous data to allow for a linear regression with salary as the dependent variable and all other variables are condensed to a set number of dummy variables. Furthermore, all variables (except salary) are converted to factors.

```{r summary}
summary(facQlfs)
```

```{r summary tables, echo=FALSE,results='asis', eval=FALSE}
# Industry
industry <- facQlfs %>% select(Industry) %>% group_by(Industry)%>% summarise(count=n())
kable(industry,col.names =c('Industry Type','#Individuals'),caption = 'Industry summary')

# Education
edu <- facQlfs %>% select(Education) %>% group_by(Education) %>% summarise(count=n())
kable(edu,col.names =c('Education Type','#Individuals'),caption='Education summary')

#NumEmployee
num_employee <-facQlfs %>% select(NumEmployee) %>% group_by(NumEmployee) %>% summarise(count=n())
kable(num_employee,col.names =c('Number of Employees', '#Individuals'),caption='Number of Employees Summary')

#Occupation
occupation <- facQlfs %>% select(Occupation) %>% group_by(Occupation) %>% summarise(count=n())
kable(occupation,col.names = c('Occupation type','#Individuals'),caption='Occupation Summary')

#Marital
marital <- facQlfs %>% select(Marital) %>% group_by(Marital) %>% summarise(count=n())
kable(marital,col.names=c('Marital status','#Individuals'),caption='Marital Status Summary')


#Religion
religion <- facQlfs %>% select(Religion) %>% group_by(Religion) %>% 
summarise(count=n())
kable(religion,col.names = c('Religion Type','#Individuals'),caption = 'Religion Summary')


#Ethnicity
ethnicity <- facQlfs %>% select(Ethnicity) %>% group_by(Ethnicity) %>% summarise(count=n())
kable(ethnicity,col.names = c('Ethnicity Type','#Individuals'),caption = 'Ethnicity Summary')

#WorkRegion
workregion <- facQlfs %>% select(Ethnicity) %>% group_by(Ethnicity) %>% summarise(count=n())
kable(ethnicity,col.names = c('Regions of Workplace','#Individuals'),caption=' Work regions Summary')
```


## 3.2 Strength and limitations

The data set is from the UK Office for National Statistics, which is a reliable and unbiased provider of information. A notable strength of the data set is its coverage of a broad range of questions and topics addressing social, economic and employment policy. In the data set, employment and economic activities are surveyed. Related topics such as occupation, training, hours of work and personal characteristics of household members aged 16 years and over are also covered. 

The application of international definitions of unemployment and economic inactivity led to a data set that can be compared to other standardised international surveys. The processing of this data set was carried out according to the highest UK Data Archive standard 'A*'. Hence, the quality of this data and documentation will not be compromised.

Despite these strengths, limitations and challenges have to be considered. During the data analysis, certain observations were identified to not be meaningful. Some questions within the survey were unanswered or the option “Not Applicable” was chosen. Such observations are inconclusive and are not beneficial for a high-performing regression model. Consequently, these observations were dropped. 

As numerous observations were excluded from the regression model, the size of the data set was decreased. The minimisation in the data set resulted in the limitation of the precision of the regression model. Additionally, due to the exclusion of observations, some of the predictors became less significant as the observations are no longer evenly spread such as in the case of the ethnicity variable. Moreover, most of the variable are of a categorical nature, enforcing the use of dummy variables. This poses additional challenges during the development of the regression model.

#4. Analysis
## 4.1 Univariate descriptive of variables
#### Age
```{r plots Age,plots Sex,out.width="60%", fig.align="center",tidy=TRUE,tidy.opts=list(width.cutoff=60),echo = FALSE,message=FALSE}
ggplot(facQlfs)+geom_point(aes(x=Age,y=Salary))+ labs(title='Annually Salary distribution of Age',x='Age',y='Salary')+ theme(plot.title = element_text(hjust = 0.5))
```

Based on the above scatter plot, there is not much information to be drawn from it. There may be a relatively small positive linear relationship between age and salary. Hence, a correlation test could be introduced in the analysis.

#### Sex
```{r plots Sex,out.width="60%", fig.align="center",tidy=TRUE,tidy.opts=list(width.cutoff=60),echo = FALSE}
# Sex
box <- ggplot(facQlfs, aes(x=Sex,y=Salary,col=Sex))+ geom_boxplot()+ labs(title='Annually Salary distribution of Gender',x='Sex',y='Salary')+ theme(plot.title = element_text(hjust = 0.5))
```

There is apparent discrimination between the two sexes in relation to salaries. Most of the females’ salary lie below the median of the males’. We can also see that the interquartile range for male series is much larger than that of females’. The range of female salary is also smaller than that of male salary, though there is one outlier. Most of the males’ salaries are positively skewed, judging from the fact that $Q3 - Q2 > Q2 - Q1$. This is not so apparent for the females. 

```{r,out.width="60%", fig.align="center",tidy=TRUE,tidy.opts=list(width.cutoff=60),echo=FALSE}
man <- c(415, 532, 686, 773, 764, 757, 749, 656, 621)
woman <- c(366, 492, 573, 613, 568, 557, 529, 518, 405)
ages <- c("21-25", "26-30", "31-35", "36-40", "41-45", "46-50", "51-55", "56-60", "60-65")

dtmw <- data.frame(ages, man, woman)
ggplot(dtmw) +geom_line(aes(x= ages, y=man,col='male'),group=1)+geom_point(aes(x= ages, y=man,col='male'))+ geom_line(aes(x= ages, y=woman,col='female'),group=2) + geom_point(aes(x= ages, y=woman,col='female'))+ylim(0,800)+ scale_color_discrete(name='Sex')+labs(title='Mean gross weekly pays in main job',x='Age',y='Salary')+theme(plot.title=element_text(hjust=0.5))
```

*Adapted from the Office of National Statistics 2017*

This initial observation, along with the above plot, seems to corroborate that males on average get higher salaries than females.

```{r table sex mean sd.,out.width="70%", echo=FALSE}
sextable<- facQlfs %>% select(Sex,Salary) %>% group_by(Sex) %>% summarise(Mean=mean(Salary),'Standard Deviation'=sd(Salary))
kable(sextable,align='l')
```

#### Industry

The three main industries of employments are compared with one another: 21% of the sampled population work in “Distribution, hotels and restaurants”, 15% work in “Banking and Finance” whilst 38% work in “Public administration, education, health”. All remaining industry jobs are summarised and aggregated in the category “Other”. 

```{r plots Industry,out.width="70%", fig.align="center",tidy=TRUE,tidy.opts=list(width.cutoff=60),echo = FALSE}
# Industry
ggplot(facQlfs, aes(x=Industry,y=Salary,col=Industry))+ geom_boxplot()+ labs(title='Annually Salary distribution of Industry',x='Industry',y='Salary')+ theme(plot.title = element_text(hjust = 0.5), axis.text = element_text(angle= 45, hjust = 0.9))

```

The above reveals clear differences between the most common three industry sectors regarding salary. The highest median salary can be found in the banking and finance industry. The median salary of the public administration, education and health industry sector is lower than the median of the finance and banking industry sector. However it is at the same time higher than the median salary of the distribution, hotel and restaurant sector. 
In comparison to these three main industry sectors, the median salary of all other industries is at the level of the banking and finance industry. 

```{r table industry mean sd, echo=FALSE}
industrytable <- facQlfs %>% select(Industry,Salary) %>% group_by(Industry) %>% summarise(Mean=mean(Salary),'Standard Deviation'=sd(Salary))
kable(industrytable,align='l')

```

#### Occupations
```{r Occupations,out.width="70%", fig.align="center",tidy=TRUE,tidy.opts=list(width.cutoff=60),echo = FALSE}
# Occupation
ggplot(facQlfs, aes(x=Occupation,y=Salary,col=Occupation))+geom_boxplot()+labs(title='Salary distribution of Occupations',x='Occupations',y='Salary')+theme(plot.title = element_text(hjust = 0.5),axis.text = element_text(angle= 45, hjust = 0.9))
```

There is a visible difference in Skilled Trades to Caring, Leisure and Other Services. This suggests that people who are highly trained have higher salaries than less skilled individuals. Managers, Directors, Senior Officials and professional groups tend to earn the highest salary amongst the 9 groups. In the high-earning sectors, the Skilled Trades category earns more than the Administrative and Secretarial group. On the other hand, salaries for groups “Sales and Customer Service” and “Elementary” are not significantly different from each other. Furthermore, both of them are in the lower earning sector. 

The median full-time gross weekly earnings for 2014 ([Annual Survey of Hours and Earnings, 2015](https://www.ons.gov.uk/employmentandlabourmarket/peopleinwork/earningsandworkinghours/bulletins/annualsurveyofhoursandearnings/2015provisionalresults#earnings-by-occupation)) demonstrated that different occupation groups would have different medians. As the skill level increases, the median earning follows. This aligns with the results observed so far.

```{r,echo = FALSE}
occuptable<- facQlfs %>% select(Occupation,Salary) %>% group_by(Occupation) %>% summarise(Mean=mean(Salary),'Standard Deviation'=sd(Salary))
kable(occuptable,digits = 0, align='l', caption = 'Salary Mean and Standard Deviation by Occupation')
```

#### Highest Education Level
```{r Highest Educational Level,out.width="70%", fig.align="center",tidy=TRUE,tidy.opts=list(width.cutoff=60),echo = FALSE}
# Education
ggplot(facQlfs, aes(x=Education,y=Salary,col=Education))+ geom_boxplot()+ labs(title='Annually Salary distribution of Highest Education Qualification',x='Highest Education Qualification',y='Salary')+ theme(plot.title = element_text(hjust = 0.5), axis.text = element_text(angle= 45, hjust = 0.9))
```

Earnings are related to the highest education qualification of employees. In general, people with higher education qualification levels earn higher incomes. A distinctive difference between median salaries can be observed from the above box plot, where employees holding degree qualifications earn on average 33% more than those with a higher education qualification. Apart from the median salary level, a higher IQR also suggests that people with a higher education level, especially the ones with degrees, earn a higher income in general than other groups.
 
```{r Education Occupation Industry,out.width="70%", fig.align="center",tidy=TRUE,tidy.opts=list(width.cutoff=60),echo = FALSE}
ggplot(facQlfs, aes(x=Occupation,fill=Education))+ geom_bar(position=position_dodge())+ labs(title='Highest Education Qualification distribution by Occupation',x='Occupation',y='Count')+ theme(plot.title = element_text(hjust = 0.5),axis.text = element_text(angle= 50, hjust = 0.9,size=6))
```

By further investigating the education qualification distribution among the different occupations, the above figure shows that people with degrees are mostly employed in professional jobs. They usually work in managerial or occupations which naturally would demand a greater skillset.  Employees having lower level of qualifications are more likely to work in service and operative occupations like caring, customer service and machine operatives. However, employees holding lower qualifications are not barred from working in high-skilled occupations. Around 47% of people educated to a degree level work as professionals. This can be compared to a 14% distribution in the second largest occupation group, managers, directors and senior officials. 

```{r,out.width="70%", fig.align="center",tidy=TRUE,tidy.opts=list(width.cutoff=60),echo = FALSE}
ggplot(facQlfs, aes(x=Industry,fill=Education))+ geom_bar(position=position_dodge())+ labs(title='Highest Education Qualification distribution by Industry',x='Industry',y='Count')+ theme(plot.title = element_text(hjust = 0.5),axis.text = element_text(angle= 50, hjust = 0.9,size=6))
```

By looking at the bar chart of industry sector by education, the majority of people who have a degree go into public admission, education, and health fields instead of banking and finance. This is interesting as we would have expected from our previous analysis that those who work in banking and finance would earn more than the other fields. Moreover, this implies that an individual is restricted in what industry sector he or she can enter if not equipped with any educational qualification.


```{r,echo=FALSE}
eductable<- facQlfs %>% select(Education,Salary) %>% group_by(Education) %>% summarise(Mean=mean(Salary),'Standard Deviation'=sd(Salary))
kable(eductable,digits = 0, align=c('l','c','r'), caption = 'Salary Mean and Standard Deviation by Education')
```

#### Employee Numbers in workplace
```{r Employee Numbers in workplace,out.width="70%", fig.align="center",tidy=TRUE,tidy.opts=list(width.cutoff=60),echo = FALSE}
# NumEmployee
ggplot(facQlfs, aes(x=NumEmployee,y=Salary,col=NumEmployee))+geom_boxplot()+labs(title='Salary distribution of Employee numbers in workplace',x='Employee Numbers',y='Salary')+theme(plot.title = element_text(hjust = 0.5))

```

The highest median salary can clearly be found for workplace of over 500 employees. However, the difference between categories under 50 and 500 is not as clear. Overall, the main difference lies between falling in the over 500 employee category, where an effect on salary is clear, and anything below, where there is no significant effect.

```{r,echo=FALSE}
numemploytable<- facQlfs %>% select(NumEmployee,Salary) %>% group_by(NumEmployee) %>% summarise(Mean=mean(Salary),'Standard Deviation'=sd(Salary))
kable(numemploytable,digits = 0, align=c('l','l','r'), caption = 'Salary Mean and Standard Deviation by # of Employees')
```

#### Religion
```{r Religion,out.width="70%", fig.align="center",tidy=TRUE,tidy.opts=list(width.cutoff=60),echo = FALSE}
# Religion
ggplot(facQlfs, aes(x=Religion,y=Salary,col=Religion))+geom_boxplot()+labs(title='Salary distribution by Religion',x='Religion',y='Salary')+theme(plot.title = element_text(hjust = 0.5),axis.text = element_text(angle= 45, hjust = 0.9))
```
```{r,echo=FALSE}
religiontable<- facQlfs %>% select(Religion,Salary) %>% group_by(Religion) %>% summarise(Mean=mean(Salary),'Standard Deviation'=sd(Salary))
kable(religiontable,digits = 0, align=c('l','l','r'), caption = 'Salary Mean and Standard Deviation by Religion')
```

It seems like there is no big difference between individuals who have a religion and those who do not. The medians are not really different from each other. It may be possible that this variable does not affect salary. 

#### Marital Status
```{r Marital,out.width="70%", fig.align="center",tidy=TRUE,tidy.opts=list(width.cutoff=60),echo = FALSE}
# Marital
ggplot(facQlfs, aes(x=Marital,y=Salary,col=Marital))+geom_boxplot()+labs(title='Salary distribution by Marital Status',x='Marital Status',y='Salary')+theme(plot.title = element_text(hjust = 0.5),axis.text = element_text(angle= 45, hjust = 0.9))+scale_color_discrete(name='Marital Status')
```

Married individuals have a slightly higher median than those who are single or other (i.e. widow or divorced). There is only a slight difference between single and other; only the range of percentile is different.


#### Ethnicity
```{r Ethnicity,out.width="70%", fig.align="center",tidy=TRUE,tidy.opts=list(width.cutoff=60),echo = FALSE}
# Ethnicity
ggplot(facQlfs, aes(x=Ethnicity,y=Salary,col=Ethnicity))+geom_boxplot()+labs(title='Salary distribution by Ethnicity',x='Ethnicity',y='Salary')+theme(plot.title = element_text(hjust = 0.5),axis.text = element_text(angle= 45, hjust = 0.9))
```

```{r,echo=FALSE}
ethtable<- facQlfs %>% select(Ethnicity,Salary) %>% group_by(Ethnicity) %>% summarise(Mean=mean(Salary),'Standard Deviation'=sd(Salary))
kable(ethtable,digits = 0, align=c('l','l','r'), caption = 'Salary Mean and Standard Deviation by Ethnicity')
```

The median for the four groups are essentially the same. However, the quantile range is different. Focusing on black people, the majority of people have a lower income of around 15000 pounds per year.

#### Region of Workplace
```{r Region of Workplace,out.width="70%", fig.align="center",tidy=TRUE,tidy.opts=list(width.cutoff=60),echo = FALSE}
# WorkRegion
ggplot(facQlfs, aes(x=workRegion,y=Salary,col=workRegion))+geom_boxplot()+labs(title='Salary distribution by Region of Workplace',x='Region of Workplace',y='Salary')+theme(plot.title = element_text(hjust = 0.5),axis.text = element_text(angle= 45, hjust = 0.9))
```

```{r,echo=FALSE}
workregtable<- facQlfs %>% select(Religion,Salary) %>% group_by(Religion) %>% summarise(Mean=mean(Salary),'Standard Deviation'=sd(Salary))
kable(workregtable,digits = 0, align=c('l','l','r'), caption = 'Salary Mean and Standard Deviation by Region of Workplace')
```

The various regions of workplace have similar median values as well as similar quantile ranges. It can be noted that only the ‘Outside UK’ category is different. However as there are only a few observations that fall into that category, they would be insignificant as not much information can be drawn from it.

## 4.2  Hypothesis tests
Prior to running a regression, further investigation into the variables is required. The correlation between age and salary will be checked. Furthermore, as there may be some association between occupation, industry sectors and education, a Chi-Square test for independence is used to check this.


### 4.2.1  Correlation Tests
$H_o$: There is no linear relationship between age and salary.

$H_a$: There is a linear relationship between age and salary.
```{r,echo = FALSE,message=FALSE}
cor.test(qlfs$Age,qlfs$Salary)
```

The p-value is 0.00378. This is smaller than a significance level of 0.05, therefore $H_o$ can be rejected. It can therefore be concluded that there is a linear relationship between age and salary. The correlation is 0.152. This is relatively small and as such, there is a weak positive relationship between age and salary.

###4.2.2 Chi-Squared Tests for Independence
$H_o$: The two categorical variables are independent from each other.

$H_a$: The two categorical variables are not independent from each other.

```{r,echo = FALSE}
chisq.test(table(facQlfs$Industry,facQlfs$Education))
chisq.test(table(facQlfs$Education,facQlfs$Occupation))

```

The p-values are far smaller than the significance level of 0.1% for both tests. This means $H_o$ can be rejected. It can thus be concluded that there is an association between education and industry as well as education and occupation.

## 4.3  Multiple Linear Regression with full dataset

```{r linear regression 1}
facQlfs.lm1 <- lm(Salary~ Age+Education+Sex+Industry+NumEmployee+Occupation+Marital+Religion+Ethnicity+workRegion,data=facQlfs )
```

```{r,echo=FALSE,results='asis'}
stargazer(facQlfs.lm1, type = "html", header = FALSE,style = "qje", 
          font.size = "scriptsize", no.space = TRUE)
```


Based on the statistical summary, four variables (Religion, Marital Status, Ethnicity and Region of Workplace appear to not be significant at a 5% level of significance. In other words, regardless of which category an individual falls into within these four variables, it will not have a significant effect on the salary they are earning based on the model. 

This result supports the lack of difference between the observed categories in the exploratory data analysis of these variables. Furthermore, dropping these variables contributes to achieving a parsimonious model.

Based on the Chi-Square independence test, as the variables are not independent from each other, there were considerations to drop one of the variables to reduce the complexity of the model. However, dropping any of the variables would reduce the model precision based on the adjusted R-square measure. Hence, both factors remain in the model whilst this relation is acknowledged.


## 4.4 Multiple Linear Regression with non-significant variables dropped

```{r}
facQlfs.lm2 <- lm(Salary ~ Age+ Education + Sex + Industry  + NumEmployee + Occupation,  data=facQlfs)
```

```{r,results='asis',echo=FALSE}
stargazer(list(facQlfs.lm1, facQlfs.lm2), type = "html", header = FALSE,style = "qje", 
          font.size = "scriptsize", no.space = TRUE)
```


At first glance, it can be seen that the adjusted $R^2$ slightly decreased from 0.4748 to 0.4677. However, the trade-off between the explanatory power of variation in the data set and the generality of the model makes it worth dropping these variables.

**Interpretation of the coefficients**:
**Age (continuous)**:
Under the conditions of ceteris paribus, an increase in age by one year will increase salary by 2.87£ on average conditional on the individual being of working age (i.e. over 16). 

**All other variables (categorical)**:
A general statement can be said about all the other variables. Holding all other variables constant, a (category of variable) earns £(coefficient value) more (or less if it is negative) than a (baseline of categorical variable) on average.

For example - for Sex and Occupation:

*Holding all other variables constant, a typical male earns 7.69£ more than a female on average.*

*Holding all other variables constant, a person in the professional field would earn 272.23£ less than Managers, Directors and Senior Officials on average.*

### 4.4.1 Model assumption checking
In order to validate the linear regression model, running a diagnostic check for independence, normality and constant variance is required.

**Independence**:
Since this is a survey data, it is assumed that the observations are independent from each other as the individuals surveyed were randomly selected. The independence condition is therefore satisfied.

**Normality**:

```{r,echo = FALSE}
qqnorm(facQlfs.lm2$residuals) 
qqline(facQlfs.lm2$residuals)
```

The qqnorm plot shows that the majority of the data falls on the “qqnormal” line which indicates that the residuals are normally distributed. The normality condition is therefore satisfied.

**Constant variance**:

```{r, echo=FALSE}

ggplot(facQlfs.lm2,aes(x=facQlfs.lm2$fitted,y=facQlfs.lm2$residuals))+geom_point()+labs(title='Residual vs. Fitted value',x='Fitted',y='Residual')+theme(plot.title = element_text(hjust = 0.5))

bptest(Salary ~ Education + Sex + 
                          Industry  + NumEmployee + 
                          Occupation,  data=facQlfs)


```

The graph of residuals against the fitted values displays the seeming existence of a trend. However, this may be due to the fact that the calculations of the salary involved using the mean for the salary interval. Otherwise, it can be concluded that there is some sort of relationship that is yet to be observed that is being captured by the error term.

It may also be that the model is not of the correct form (i.e. polynomial form) due to the fact that some important predictors may have been missed from excluding limiting explanatory variable to those specifically interested in. 

Using the bptest (Breusch-Pagan test) from the “lmtest” library, it indicated that there is no constant variance. The null hypothesis is that there is homoscedasticity, meaning that the variance does not depend on auxiliary regressors. The obtained p-value (0.001) is really small so the $H_o$ can be rejected. 

Although constance variance is not satisfied, performing a logarithmic transformation does not rectify this condition (the adjusted $R^2$ becomes 0.2879).

## 4.5 Pairwise t-tests
$H_o$: The mean of salary for one group is same as another group in a variable.

$H_a$: The mean of salary for one group is not the same as another group in a variable. 

```{r,echo = FALSE,message=FALSE}
pairwise.t.test(facQlfs$Salary,facQlfs$Education)
pairwise.t.test(facQlfs$Salary,facQlfs$Sex)
pairwise.t.test(facQlfs$Salary,facQlfs$Industry)
pairwise.t.test(facQlfs$Salary,facQlfs$NumEmployee)
pairwise.t.test(facQlfs$Salary,facQlfs$Occupation)
```

Notice that the pairwise t-test compares every category of a variable and checks whether there is a significant mean difference between them. However, the limitation is the assumption that the data set follows a normal distribution. The data set is, however, not normally distributed considering majority of the variables are categorical in nature.

If the p-value is greater than 0.05 significant level, $H_o$ is rejected and it can be concluded that $H_a$ is true. 
If the p-value is smaller than 0.05 significant level, rejecting the $H_o$ fails and it can be concluded $H_a$ is true. 

**NumEmployee**:
There is significant evidence to prove that there are different means of salary for NumEmployee between each category on average.

**Sex**:
There is significant difference between the two genders. This could indicate the existence of gender discrimination. Considering the 1.07 ratio of female to male observations, the discrimination cannot be regarded as merely a sampling error.

**Industry**:
There is significant evidence to prove that the mean is different between each category within the Industry variable except for the “Banking & Finance” and “Other” groups. 

**Occupation**:
There is no significant mean difference between each occupation except for “Caring, Leisure and other service”, “Sales and Customer Service” and “Elementary”. Occupation was believed to be an ordinary factor which has a natural order. However, based on the results and observations, it seems this could be a nominal variable as there is no sufficient evidence to prove that some of the group mean salary are different for each other.

**Education**:
There is sufficient evidence indicating that mean salary of the “Degree” group is different from the other four groups. This follows the results observed when exploring the Education variable where those with a higher degree earned the highest salary. However, there is no evidence that the other four groups have different mean salary.

#5. Discussion and Conclusion

The aim of this project is to develop a regression model predicting a person’s salary. 
The data set about the labour workforce of the United Kingdom provided by the UK Office for National Statistics initially included 739 variables and 88,528 observations. Guided by the literature, a subset of 11 variables of interest were selected: age, sex, occupation, industry, education, number of employees, religion, marital status, ethnicity and region of workplace. Regarding these identified variables, the data set was explored descriptively and statistical tests such as the Student’s t-test and Chi-square test were performed to investigate the significance and influence of the different variables leading to interesting results. 

The univariate data exploration led to the result that one should note that the number of employees in the workplace can be interpreted as the size of the organisation and therefore inferences made would follow this logic. An inference that can be made therefore is that the larger the organisation, the more likely one earns a higher salary. Additionally, there is evidence of gender discrimination within the data set and this result is not only due to the data set upon the rejection of the $H_o$ at the 0.1% significance level. Moreover, motivation for studying a Master’s programme instead of stopping at an undergraduate level is provided as it was discovered that a Master’s degree results in a significantly higher salary. Interestingly,  in the industry sector “ Banking and Finance”, the salary is the highest comparatively.

A counterintuitive finding revealed that ethnicity is not significant and can be excluded from the regression model. However, when considering the limited numbers of observations of ethnicities other than “white”, the results are less surprising (White: 486, Asian: 21, Black: 15  , Other: 21).

The bivariate data exploration of the variables education and occupation, education and industry led to the conclusion that both tuples of variables are not independent and must be included in a subsequent linear regression model.

Overall, the findings led to a reduced set of variables which only include age, sex, occupation, industry, education and number of employees serving as independent variables for the development of a linear regression model predicting salary.

Generally, the model can be used to answer questions regarding monetary securities (such as loans, credit card debt repayment). Moreover, customised offers and advertisements can be sent to clients and customers driving a company’s business success. Given a non-discriminating and exaggerated circumstances, a customer with a very low salary would for instance receive advertisements or discount coupons for purchasing toothpaste whilst a customer with a high salary would receive an invitation to try out a new sports car model. In both situations, there is a form of mutualism in play in terms of both the customer’s satisfaction and the business’s return.

After exploring the selected data set descriptively and building a linear regression model predicting the salary of people of different sex, age, educational qualifications and industries, the subsequent action is to test the accuracy of the developed predictive model. Thus, testing the model on more data sets is required. This would serve as a reference in validating the performance analysis of the model. 

The applicability of the conceived model on other countries with similar socio-economical structures can then be tested. An interesting study would therefore be to determine whether the developed model predicts the salary for citizens of those countries with sufficient accuracy. If this is satisfied, other european countries could potentially apply the model. Furthermore, based on the findings, an adapted and more specific questionnaire could minimise the need to exclude observations. Undoubtedly, one should not restrict this to the extent where it is biased. The removal of this limitation could result in a potential improvement of the accuracy of the predictive model.


#6. Project Github Repository
[Link for Project Github Repository](https://github.com/wygdd/MSF_Project)

#7. References

Blinder, S. A. (1973) ‘Wage Discrimination: Reduced Form and Structural Estimates’, The Journal of Human Resources, 8(4), pp. 436-455. [Accessed 11 October 2017]
Available at: http://www.jstor.org/stable/pdf/144855.pdf?refreqid=excelsior%3Aaabd22fcb1bb4b577ca37a51c72dea58
 
Bovill, D. (2015) ‘Annual Survey of Hours and Earnings: 2015 Provisional Results’ [Accessed 12 October 2017]
Available at: https://www.ons.gov.uk/employmentandlabourmarket/peopleinwork/earningsandworkinghours/bulletins/annualsurveyofhoursandearnings/2015provisionalresults

Brynin, M and Güveli, A. (2012) ‘Understanding the ethnic pay gap in Britain’, Work, employment and society, 26(4), pp. 574-587. [Accessed 10 October 2017]
Available at: http://journals.sagepub.com/doi/pdf/10.1177/0950017012445095

European Union (2014) ‘Tackling the gender pay gap in the European Union’, pp. 15. [Accessed 10 October 2017]
Available at: http://ec.europa.eu/justice/gender-equality/files/gender_pay_gap/140319_gpg_en.pdf

Gerhard, U., Schwarzer, A. and Slupik, V. (eds) (1988) ‘Auf Kosten der Frauen. Frauenrechte im Sozialstaat’, Weinheim/Basel: Beltz Verlag. 
						
Kickbusch, I. and Riedmüller, B. (eds) (1984) ‘Die armen Frauen. Frauen und Sozialpolitik’, Frankfurt/Main: Suhrkamp. 

Mattila, A. and Choi, C. (2013) 'An Analysis of Consumers’ Reactions to Travel Websites’ Discrimination by Computer Platform' Cornell Hospitality Quarterly, 55(2), 210-215 Journals.sagepub.com. [Accessed 13 Oct. 2017]. Available at: http://journals.sagepub.com/doi/pdf/10.1177/1938965513509879

Office for National Statistics Social Survey Division, Northern Ireland Statistics and Research Agency. Central Survey Unit (ONS) (2017), ‘Quarterly Labour Force Survey, January - March, 2017’, UK Data Service. [Accessed 27 September 2017]
Available at: http://doi.org/10.5255/UKDA-SN-8195-1 

United Nations (2017). *‘United Nations Sustainable Development: Gender equality and women's empowerment.’*
[Accessed 11 October 2017]
Available at: http://www.un.org/sustainabledevelopment/gender-equality/



